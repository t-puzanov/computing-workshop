# Конспект

> Конспект с лекций по ВМАиЛА, лектор С. П. Шарый, ММФ НГУ, 2024 г.

> 1. Построение интерполяционного кубического сплайна.
> 2. Метод прогонки для решения СЛАУ с трехдиагональными матрицами.

# Построение кубического сплайна

Пусть задан интервал ${[a, b] \subset \mathbb{R}}$, набор узлов ${x \in \mathbb{R}^{N+1}}$, такой, что $a = x_0 \le x_1 < \dots < x_N = b$, и набор значений ${y \in \mathbb{R}^{N+1}}$. 

## Определения

**Интерполяционным кубическим сплайном** называется такая функция $S(x) : [a, b] \to \mathbb{R}$, что для нее верно следующее:

1. В узлах функция принимает заданные значения ${S(x_i) = y_i}, \ i={0,1,\dots,N} $.

2. Функция $S(x)$ должна быть дважды непрерывно-дифференцируемой на отрезке ${[a, b]}$. 

3. На каждом подинтервале ${[x_{i}, x_{i+1}]}$ функция $S(x)$ должна являться алгебраическим полиномом 3-й степени. 

__________

Матрицу $A = (a_{ij})$ называют **матрицей с диагональным преобладанием**, если имеет место

$$\left| a_{ii} \right| \ge \sum_{j \ne i}^{} \left| a_{ij} \right|$$


## Построение интерполяционного кубического сплайна

### Условия на сплайн

Для каждого подинтервала $[x_i, x_{i+1}]$ сплайн $S(x)$ является полиномом 3-й степени. Положим, что для всех $x \in {[x_{i}, x_{i+1}]}$

$$S(x) = \lambda_{i3} x^3 + \lambda_{i2} x^2 + \lambda_{i1} x + \lambda_{i0}.$$

Для построения интерполяционного кубического сплайна нужно определить значения $4N$ неизвестных коэффициентов.

Из определения интерполяционного кубического сплайна можно получить условия на коэффициенты $\lambda_{ij}$

- $3(N-1)$ условий непрерывности функций ${S(x)},{S^{\prime}(x)}$ и ${S^{\prime \prime}(x)}$.

    $$ S^{(k)}(x_i - 0) = S^{(k)}(x_i + 0) \ \ k=0,1,2; \ i = 1,\dots,{N-1} $$

- $(N+1)$ условий интерполяции, $S(x_i) = y_i$.

В итоге получается $4N - 2$ условий. Два недостающих условия определяют различными способами. Наиболее популярные:

1. $S^{\prime}(a) = \beta_0, \ S^{\prime}(b) = \beta_N$
2. $S^{\prime \prime}(a) = \gamma_0, \ S^{\prime \prime}(b) = \gamma_n$
3. $S^{(k)}(a) = S^{k}(b), \ k=0,1,2$


### Построение СЛАУ

Будем искать кусочно-полиномиальное представление кубического сплайна в виде, привязанном к узлам сплайна $x_i$

$$ S(x) = \alpha_i + \beta_i (x - x_i) + \gamma_i \frac{(x - x_i)^2}{2} + \delta_i \frac{(x - x_i)^3}{6} $$

для $x \in [x_{i}, x_{i+1}], \ \ i = 0, 1, \dots , N - 1$.

В такой форме сплайна величины $\beta_i$ и $\gamma_i$ совпадают по смыслу с теми, что даются в условиях (1), (2).

Найдем вторую производную фукции $S(x)$:

$$ S^{\prime \prime}(x) = \gamma_i + \delta_i (x - x_i), \ \ \ x \in [x_i, x_{i+1}]$$

Из представления следует, что $S^{\prime \prime}(x_i) = \gamma_i$. 

$S^{\prime \prime}(x)$ - линейная функция, проходящая на концах интервала $[x_i, x_{i+1}]$ через точки $\gamma_i, \gamma_{i+1}$, поэтому для всех $x \in [x_i, x_{i+1}]$ справедлива формула

$$S^{\prime \prime}(x) = \gamma_i \frac{x - x_{i+1}}{x_{i} - x_{i+1}} + \gamma_{i+1} \frac{x - x_i}{x_{i+1} - x_{i}}$$

или

$$S^{\prime \prime}(x) = \gamma_i \frac{x_{i+1} - x}{h_{i+1}} + \gamma_{i+1} \frac{x - x_i}{h_{i+1}}$$

где $h_{i+1} = {x_{i+1} - x_i}$ - длинна интервала ${[x_{i}, x_{i+1}]}$.

Построенная функция $S^{\prime \prime}(x)$ удовлетворяет условию "непрерывной склейки" в узлах $x_1,\dots,x_{N-1}$

$$S^{\prime \prime}(x_i - 0) = S^{\prime \prime}(x_i + 0) \ \ \ \ i = 1, \dots, N-1$$

Восстановим $S(x)$, дважды выполнив интегрирование функции $S^{\prime \prime}(x)$.

$$S(x) = \gamma_i \frac{(x_{i+1} - x)^3}{6 h_{i+1}} + \gamma_{i+1} \frac{(x - x_i)^3}{6 h_{i+1}} + C_1 x + C_2$$

где $C_1, C_2$ - некоторые константы, зависящие от $i$.

Представим выражение в более удобной форме:

$$S(x) = \gamma_i \frac{(x_{i+1} - x)^3}{6 h_{i+1}} + \gamma_{i+1} \frac{(x - x_i)^3}{6 h_{i+1}} + K_1 (x_{i+1} - x) + K_2 (x - x_i)$$

$$C_1 = -K_1 + K_2, \ \ C_2 = K_1 x_{i+1} - K_2 x_i$$

Константы $K_1, K_2$ и $C_1, C_2$ можно связать невырожденным линейным преобразованием, поэтому две предыдущие записи функции $S(x)$ эквивалентны.

Для определения $K_1, K_2$ используем интерполяционные условия.

Подставляя в выражение для $S(x)$ значения $x = x_i$ и используя условия $S(x_i) = y_i$, получим

$$\gamma_i \frac{(x_{i+1} - x_i)^3}{6 h_{i+1}} + K_1 (x_{i+1} - x_i) = y_i,$$

откуда

$$K_1 = \frac{y_i}{h_{i+1}} - \frac{\gamma_i h_{i+1}}{6}.$$

Аналогично, подставляя в выражение для $S(x)$ значение $x = x_{i+1}$ и используя условие $S(x_{i+1}) = y_{i+1}$, найдём

$$K_2 = \frac{y_{i+1}}{h_{i+1}} - \frac{\gamma_{i+1} h_{i+1}}{6}$$

Теперь $S(x)$ определяется только параметрами $\gamma_0, \gamma_1, \dots, \gamma_{N}$ и не содержит в представлении коэффициенты $\alpha_i, \beta_i, \delta_i$.

- Подставив в формулу для $S(x)$ значения $K_1, K_2$ и продифференцировав по $x$, будем иметь для каждого подинтервала $[x_i, x_{i+1}]$ представление

    $$ S^{\prime}(x) = \frac{y_{i+1} - y_i}{h_{i+1}} - \gamma_i \frac{3(x_{i+1} - x)^2 - h^2_{i+1}}{6 h_{i+1}} + \gamma_{i+1} \frac{3(x - x_i)^2 - h^2_{i+1}}{6 h_{i+1}} $$

    Следовательно, с учётом того, что $h_{i+1} = x_{i+1} - x_i$, получим

    $$ S^{\prime}(x_i) = \frac{y_{i+1} - y_i}{h_{i+1}} - \gamma_{i} \frac{h_{i+1}}{3} - \gamma_{i+1} \frac{h_{i+1}}{6} $$

- С другой стороны, сдвигая все индексы в формуле для $S^{\prime}(x)$ на единицу назад, будем иметь для подинтервала $[x_{i-1}, x_i]$ представление

    $$ S^{\prime}(x) = \frac{y_{i} - y_{i-1}}{h_{i}} - \gamma_{i-1} \frac{3(x_{i} - x)^2 - h^2_{i}}{6 h_{i}} + \gamma_{i} \frac{3(x - x_{i-1})^2 - h^2_{i}}{6 h_{i}} $$

    Следовательно, с учётом того, что $h_i = x_i - x_{i-1}$, получим

    $$ S^{\prime}(x_i) = \frac{y_{i} - y_{i-1}}{h_{i}} + \gamma_{i-1} \frac{h_{i}}{6} - \gamma_{i} \frac{h_{i}}{3} $$


Приравнивание этих производных, которые получены в узлах $x_i$
с соседних подинтервалов $[x_{i-1}, x_i]$ и $[x_i, x_{i+1}]$, даёт уравнения

$$\frac{h_i}{6} \gamma_{i-1} + \frac{h_i + h_{i+1}}{3} \gamma_i + \frac{h_{i+1}}{6} \gamma_{i+1} = \frac{y_{i+1} - y_i}{h_{i+1}} - \frac{y_i - y_{i-1}}{h_i}$$

где $i = 1, \dots, N-1$.

Запишем полученную СЛАУ в матричном виде, в случае, когда $\gamma_0, \gamma_N$ известны.

$$H = \frac{1}{6} \begin{pmatrix}
2 (h_1 + h_2) & h_2 & 0 & \cdots & 0 \\
h_2 & 2(h_2 + h_3) & h_3 &  & \vdots \\
0 & h_3 & \ddots & \ddots \\
\vdots & & \ddots & & h_{N-1} \\
0 & \cdots & & h_{N-1} & 2(h_{N-1} + h_N)
\end{pmatrix}$$

$$ H \gamma = b \tag{1}$$

Вектор неизвестных $\gamma = (\gamma_1, \dots, \gamma_{N-1})$. 

Вектор $b = (b_1, \dots, b_{N-1})$.

$$b_1 = \frac{y_2 - y_1}{h_{2}} - \frac{y_1 - y_0}{h_1} - \frac{h_1 \gamma_0}{6}$$

$$b_{N-1} = \frac{y_{N} - y_{N-1}}{h_{N}} - \frac{y_{N-1} - y_{N-2}}{h_{N-1}} - \frac{h_{N} \gamma_{N}}{6}$$

$$b_i = \frac{y_{i+1} - y_i}{h_{i+1}} - \frac{y_i - y_{i-1}}{h_i}$$

> Матрица $H$ по признаку Адамара является неособенной (т.к. $H$ - матрица с диагональным преобладанием), поэтому решение СЛАУ существует и единственно.

### Условия и СЛАУ

Ранее упоминалось, что дополнительные условия на сплайн можно задать различными способами, и что наиболее часто используемыми являются:

1. $S^{\prime}(a) = \beta_0, \ S^{\prime}(b) = \beta_N$
2. $S^{\prime \prime}(a) = \gamma_0, \ S^{\prime \prime}(b) = \gamma_n$
3. $S^{(k)}(a) = S^{k}(b), \ k=0,1,2$

#### СЛАУ для условий 2

Формула для интерполяционного кубического сплайна $S(x)$ была получена, путем двойного интегрирования линейной функции $S^{\prime \prime}(x)$

$$S^{\prime \prime}(x) = \gamma_i \frac{x_{i+1} - x}{h_{i+1}} + \gamma_{i+1} \frac{x - x_i}{h_{i+1}} \tag{2}$$

Найдем значения второй производной $S(x)$ на концах интервала $[a,b]$

$$S^{\prime \prime}(a) = \gamma_0 \frac{x_{1} - x_0}{h_{1}} + \gamma_{1} \frac{x_0 - x_0}{h_{1}} = \gamma_0$$

$$S^{\prime \prime}(b) = \gamma_{N-1} \frac{x_{N} - x_N}{h_{N}} + \gamma_{N} \frac{x_N - x_{N-1}}{h_{N}} = \gamma_N$$

Поэтому параметры $\gamma_i$ в формулах совпадают по смыслу с параметрами из условия 2.

Т.к. $\gamma_0, \gamma_N$ известны, можно определить оставшиеся коэффициенты $\gamma_i$ из системы $H \gamma = b$. 


#### СЛАУ для условий 1

Пусть заданы краевые условия

$$S^{\prime}(a) = \beta_0, \ S^{\prime}(b) = \beta_N$$

Формула первой производной функции $S(x)$ имеет вид

$$ S^{\prime}(x) = \frac{y_{i+1} - y_i}{h_{i+1}} - \gamma_i \frac{3(x_{i+1} - x)^2 - h^2_{i+1}}{6 h_{i+1}} + \gamma_{i+1} \frac{3(x - x_i)^2 - h^2_{i+1}}{6 h_{i+1}} $$

Найдем значение $S^{\prime}$ в точке $a$

$$ S^{\prime}(a) = \frac{y_{1} - y_0}{h_{1}} - \gamma_0 \frac{3(x_{1} - x_0)^2 - h^2_{1}}{6 h_{1}} + \gamma_{1} \frac{3(x_0 - x_0)^2 - h^2_{1}}{6 h_{1}} = $$

$$ \frac{y_{1} - y_0}{h_{1}} - \gamma_0 \frac{h_1}{3} - \gamma_{1} \frac{h_{1}}{6} = \beta_0 $$

Теперь в точке $b$

$$ S^{\prime}(b) = \frac{y_{N} - y_{N-1}}{h_{N}} - \gamma_{N-1} \frac{3(x_{N} - x_N)^2 - h^2_{N}}{6 h_{N}} + \gamma_{N} \frac{3(x_N - x_{N-1})^2 - h^2_{N}}{6 h_{N}} = $$

$$\frac{y_{N} - y_{N-1}}{h_{N}} + \gamma_{N-1} \frac{ h_{N}}{6} + \gamma_{N} \frac{h_N}{3} = \beta_N$$

В итоге получим новую СЛАУ

$$
\begin{cases}
    \ \ \dfrac{y_{1} - y_0}{h_{1}} - \gamma_0 \dfrac{h_1}{3} - \gamma_{1} \dfrac{h_{1}}{6} = \beta_0 \\ \\
    \ \ \dfrac{y_{N} - y_{N-1}}{h_{N}} + \gamma_{N-1} \dfrac{ h_{N}}{6} + \gamma_{N} \dfrac{h_N}{3} = \beta_N \\ \\ 

    \ \ H^{(*)} \gamma = b^{(*)}
\end{cases}
$$

Запишем полученную систему в матричном виде

$$H^{(1)} = \frac{1}{6} \begin{pmatrix}
2 h_1 & h_1 & 0 & 0 & \cdots & 0 & 0 \\
h_1 & 2 (h_1 + h_2) & h_2 & 0 & \cdots & 0 & 0 \\
0 & h_2 & 2(h_2 + h_3) & h_3 &  & \vdots & 0 \\
0 & 0 & h_3 & \ddots & \ddots & & \vdots \\
\vdots & \vdots & & \ddots & & h_{N-1} & 0 \\
0 & 0 & \cdots & & h_{N-1} & 2(h_{N-1} + h_N) & h_N \\
0 & 0 & \cdots & & 0 & h_N & 2 h_N
\end{pmatrix}$$

$$ H^{(1)} \gamma = b^{(1)}$$

Вектор неизвестных $\gamma = (\gamma_0, \gamma_1, \dots, \gamma_{N})$. 

Вектор $b^{(1)} = (b^{(1)}_0, b^{(1)}_1, \dots, b^{(1)}_{N})$.

$$b^{(1)}_0 = \frac{y_1 - y_0}{h_1} - \beta_0$$
$$b^{(1)}_N = \beta_N - \frac{y_N - y_{N-1}}{h_N}$$
$$b^{(1)}_i = \frac{y_{i+1} - y_i}{h_{i+1}} - \frac{y_i - y_{i-1}}{h_i} $$

> Матрица $H^{(1)}$ также является матрицей с диагональным преобладанием, поэтому (по признаку Адамара) является неособенной. Значит существует единственное решение СЛАУ.


# Метод прогонки для решения СЛАУ с трехдиагональными матрицами

**Трехдиагональная матрица** - это матрица вида

$$
\begin{pmatrix} 
b_1 & c_1 & 0 & & \cdots & 0 \\
a_2 & b_2 & c_2 & 0 & \\
0 & a_3 & b_3 & c_3 & \\
\vdots & & \ddots & \ddots & \ddots \\ 
& & & a_{n-1} & b_{n-1} & c_{n-1}\\
0 & \cdots & & & a_n & b_n
\end{pmatrix}$$

Система $n$ линейных алгебраических уравнений относительно неизвестных $x_1, \dots, x_n$, имеющая трёхдиагональную матрицу, в развёрнутом виде выглядит

$$
\begin{cases}
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \  b_1 x_1 + c_1 x_2 = d_1 \\
a_i x_{i-1} + b_i x_{i} + c_i x_{i+1} = d_i \\
a_n x_{n-1} + b_n x_n \ \ \ \ \ \ \ \ \ \ \ \ = d_n
\end{cases}
$$

Часто её записывают в специальном каноническом виде

$$a_i x_{i-1} + b_i x_{i} + c_i x_{i+1} = d_i, \ \ \ i=1,\dots, n$$

где для единообразия полагают $a_1 = c_n = 0$ в качестве коэффициентов при фиктивных переменных $x_0$ и $x_{n+1}$.

Пусть для СЛАУ с трёхдиагональной матрицей выполняется прямой ход метода Гаусса без перестановок строк и столбцов матрицы, т. е. без специального выбора ведущего элемента.

Если он успешно прорабатывает до конца, то приводит к системе с двухдиагональной матрицей вида

$$
\begin{pmatrix}
\times & \times & 0 & \cdots & 0 \\
0 & \times & \times & & \vdots \\
\vdots & & \ddots & \ddots \\
0 & \cdots & 0 & \times & \times
\end{pmatrix}
$$

в которой ненулевые элементы присутствуют лишь на главной
диагонали и первой наддиагонали.

Формулы обратного хода метода Гаусса принимают более простой вид, чем в общем случае

$$x_i = \xi_{i+1} x_{i+1} + \eta_{i+1}, \ \ \ i = n, n-1, \dots, 1 \tag{1}$$

где, как и в исходных уравнениях, в $n$-ом соотношении присутствует вспомогательная фиктивная неизвестная $x_{n+1} = 0$.

Уменьшим в (1) все индексы на единицу

$$x_{i-1} = \xi_{i} x_{i} + \eta_{i}$$

и подставим полученное соотношение в $i$-ое уравнение

$$a_i (\xi_{i} x_{i} + \eta_{i}) + b_i x_i + c_i x_{i+1} = d_i$$

Отсюда

$$x_i = - \dfrac{c_i}{a_i \xi_i + b_i} x_{i+1} + \dfrac{d_i - a_i \eta_i}{a_i \xi_i + b_i}$$

Сравнивая с формулами (1) можно заключить, что

$$ \xi_{i+1} = - \dfrac{c_i}{a_i \xi_i + b_i}, \ \ \ \ \eta_{i+1} = \dfrac{d_i - a_i \eta_i}{a_i \xi_i + b_i} \tag{2}$$

Формулы (2) определяют **прямой ход** прогонки, его целью является вычисление **прогоночных коэффициентов** $\xi_i, \eta_i$.

Далее по формулам (1) выполняется **обратный ход**, который позволяет получить искомые значения неизвестных.

Совместно прямой ход и обратный ход определяют **метод прогонки** для решения СЛАУ с трёхдиагональной матрицей.

Из формул (2) следует, что

$$\xi_2 = - \dfrac{c_1}{a_1 \xi_1 + b_1} = - \dfrac{c_1}{b_1}$$

$$\eta_2 = \dfrac{d_1 - a_1 \eta_1}{a_1 \xi_1 + b_1} = \dfrac{d_1}{b_1}$$

Коэффициенты $\xi_2,\dots,\xi_{n+1}$ и $\eta_2,\dots,\eta_{n+1}$ не зависят от $\xi_1, \eta_1$, поэтому и значения неизвестных $x_i$ от них тоже не зависят.

Более удобна реализация прогонки, при которой прямой ход начинается с присваивания

$$\xi_2 = - \dfrac{c_1}{b_1}, \ \, \eta_2 = \dfrac{d_1}{b_1}$$